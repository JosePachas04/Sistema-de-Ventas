<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConfirmaciÃ³n de Pedido - TuAbarrote</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/general.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navigation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/confirmation.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* ... (tus estilos existentes de confirmation.css y los inline) ... */
         .order-item-unit-measure {
            font-size: 0.8em;
            color: #777;
            display: block;
            margin-top: 3px;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="container top-bar-content">
            <div class="top-bar-left">
                <a href="{{ url_for('nosotros') }}">Sobre Nosotros</a>
                <a href="#">Mi Cuenta</a>
            </div>
            <div class="top-bar-right">
                 <span>Idioma: ES âŒ„</span>
                 <span>Moneda: USD âŒ„</span>
                 <a href="#">Seguimiento de Pedido</a>
                 {% if is_logged_in %}
                     <span>Hola, {{ session.username }}</span> |
                    {% if user_role == 'admin' %}
                         <a href="{{ url_for('admin_dashboard') }}">Dashboard Admin</a> |
                     {% endif %}
                    <a href="{{ url_for('logout') }}">Cerrar SesiÃ³n</a>
                {% else %}
                    <a href="{{ url_for('login') }}">Iniciar SesiÃ³n</a> |
                    <a href="{{ url_for('register') }}">Registrarse</a>
                {% endif %}
                 {% if is_logged_in and user_role != 'admin' %}
                    <a href="{{ url_for('view_cart') }}" class="cart-icon-top">ðŸ›’ <span class="cart-count">({{ session['cart'] | length if session['cart'] is defined else 0 }})</span></a>
                 {% endif %}
            </div>
        </div>
    </div>

    <header>
        <div class="container header-content">
            <div class="logo">TuAbarrote</div>
            <div class="search-bar">
                <form action="{{ url_for('search') }}" method="GET">
                    <input type="text" name="query" placeholder="Buscar productos, categorÃ­as o marcas..." value="{{ query if query is not none else '' }}">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>
            </div>
        </div>
    </header>

    <nav class="main-nav">
        <div class="container">
            <ul>
                <li><a href="{{ url_for('products_for_customer') }}">Tienda</a></li>
                 {% if user_role == 'admin' %}
                 <li><a href="{{ url_for('products') }}">GestiÃ³n Productos (Admin)</a></li>
                 {% endif %}
                 <li><a href="{{ url_for('nosotros') }}">Nosotros</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="confirmation-container">
            <h2>Â¡Gracias por tu compra!</h2>
            {% if order %}
                <p>Tu pedido <strong>#{{ order.id }}</strong> ha sido procesado con Ã©xito.</p>
            {% else %}
                <p>Tu pedido ha sido procesado con Ã©xito.</p>
            {% endif %}


            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div style="margin-bottom: 20px;">
                    {% for category, message in messages %}
                         <p class="message {{ category }}">{{ message }}</p>
                    {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            {% if order %}
                <div class="order_details_summary">
                    <h3>Detalles del Pedido</h3>
                    <p><strong>NÃºmero de Pedido:</strong> {{ order.id }}</p>
                    <p><strong>Fecha del Pedido:</strong> {{ order.order_date.strftime('%d/%m/%Y %H:%M') if order.order_date else 'N/A' }}</p>
                    <p><strong>Estado:</strong> {{ order.status }}</p>
                    <p><strong>Total:</strong> S/.{{ "%.2f" | format(order.total_amount) }}</p>

                    <h4>Items del Pedido:</h4>
                    {% if order_items %}
                        <ul>
                            {% for item in order_items %}
                                <li>
                                     <div class="item_info">
                                         {% if item.image_filename %}
                                             <div class="item_image">
                                                 <img src="{{ url_for('static', filename='uploads/products/' + item.image_filename) }}" alt="{{ item.name }}">
                                             </div>
                                         {% else %}
                                              <div class="item_image">
                                                 <img src="{{ url_for('static', filename='images/no_image_placeholder.png') }}" alt="Sin imagen disponible">
                                             </div>
                                         {% endif %}
                                         <div class="item_details">
                                             <h4>{{ item.name }}</h4>
                                             {% if item.unidad_medida %} <span class="order-item-unit-measure">Unidad: {{ item.unidad_medida }}</span>
                                             {% endif %}
                                             <p>Cantidad: {{ item.quantity }} | Precio Unitario: S/.{{ "%.2f" | format(item.price_at_purchase) }}</p>
                                         </div>
                                     </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                         <p>No se encontraron items para este pedido.</p>
                    {% endif %}
                </div>
            {% elif error %}
                 <p class="message danger">{{ error }}</p>
            {% else %}
                 <p>No se pudieron cargar los detalles de tu pedido.</p>
            {% endif %}

            <div class="back-to-home">
                <p><a href="{{ url_for('index') }}">Volver a la pÃ¡gina principal</a></p>
            </div>
        </div>
    </div>
</body>
</html>